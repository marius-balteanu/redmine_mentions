<% if @project %>
  <% users = @project.users.to_a.delete_if{|u| (u.type != 'User' || u.mail.empty?)}%>
<% else %>
  <% users = User.active.to_a.delete_if{|u| (u.type != 'User' || u.mail.empty?)}%>
<% end %>

<script>
  if (typeof tribute === "undefined") {
    var users = <%= users.pluck(:firstname, :lastname, :login).map { |firstname, lastname, login| { key: "#{firstname} #{lastname}", value: login } }.to_json.html_safe %>
    var tribute = new Tribute({
        menuContainer: document.getElementById("content"),
        values: users,
    });

    document.addEventListener('DOMContentLoaded', function(event) {
        tribute.attach(document.getElementsByClassName("wiki-edit"));
    })
  }

</script>
